#!/bin/bash
# Restore original monitor configuration

set -e  # Exit on any error

# File where original monitor configuration was saved
ORIGINAL_MONITORS_FILE="/tmp/hyprland_original_monitors.txt"

# Log file for debugging
LOG_FILE="/tmp/sunshine-stop-hypr.log"

# Function to log with timestamp
log() {
    echo "[$(date '+%Y-%m-%d %H:%M:%S')] $1" | tee -a "$LOG_FILE"
}

# Start logging
log "=== Starting sunshine-stop-hypr ==="

# Clean up the headless monitor
log "Cleaning up headless monitor..."
hyprctl keyword monitor "HEADLESS-2,disable" 2>/dev/null || true
hyprctl output destroy HEADLESS-2 2>/dev/null || true

# Restore the original monitor resolution (if it was changed)
log "Ensuring physical monitor is at original resolution..."
hyprctl keyword monitor "HDMI-A-2,3840x2160@240,0x0,1"

# Verify physical monitor is working
log "Verifying monitor restoration..."
hyprctl monitors | tee -a "$LOG_FILE"

if hyprctl monitors | grep -q "HDMI-A-2"; then
    log "SUCCESS: Physical monitor HDMI-A-2 restored successfully"
else
    log "WARNING: Physical monitor may not be fully restored"
    log "Try running: hyprctl keyword monitor 'HDMI-A-2,3840x2160@240,0x0,1'"
fi

# Clean up the temporary file
rm -f "$ORIGINAL_MONITORS_FILE"
log "Cleaned up temporary files"

log "=== sunshine-stop-hypr completed ==="
